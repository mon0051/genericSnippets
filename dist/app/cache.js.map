{"version":3,"sources":["../../app/cache.js"],"names":["server","require","TimeStampedObj","value","time","updated","undefined","Date","toString","CachedObject","initLocalValue","id","that","local","remote","pushup","cache","cacheObject","getFromCache","Promise","resolve","reject","state","p","then","v","console","log"],"mappings":";;AAAC,aAAY;AACT,QAAIA,SAASC,QAAQ,kBAAR,GAAb;;AAEA,aAASC,cAAT,CAAwBC,KAAxB,EAA+BC,IAA/B,EAAqC;AACjC,YAAG,CAACA,IAAJ,EAAS;AACL,gBAAIA,SAAS,KAAb,EAAoB;AAChB,qBAAKC,OAAL,GAAe,IAAf;AACH;AACD,gBAAI,KAAKA,OAAL,KAAiBC,SAArB,EAAgC;AAC5B,qBAAKD,OAAL,GAAe,IAAIE,IAAJ,EAAf;AACH;AACJ,SAPD,MAOK;AACD,iBAAKF,OAAL,GAAeD,IAAf;AACH;;AAED,aAAKD,KAAL,GAAaA,KAAb;AACA,aAAKK,QAAL,GAAgB,YAAY;AACxB,mBAAO,yBAAP;AACH,SAFD;AAGH;;AAED,aAASC,YAAT,CAAsBC,cAAtB,EAAqCC,EAArC,EAAyC;AACrC,YAAIC,OAAO,IAAX;AACA,aAAKC,KAAL,GAAa,IAAIX,cAAJ,CAAmBQ,cAAnB,CAAb;AACA,aAAKI,MAAL,GAAc,IAAIZ,cAAJ,CAAmB,IAAnB,EAAyB,KAAzB,CAAd;AACA,aAAKC,KAAL,GAAa,YAAY;AACrB,gBAAGS,KAAKC,KAAL,CAAWR,OAAX,IAAsBO,KAAKE,MAAL,CAAYT,OAArC,EAA6C;AACzCL,uBAAOe,MAAP,CAAcJ,EAAd,EAAiBC,KAAKC,KAAL,CAAWV,KAA5B;AACA,uBAAOS,KAAKC,KAAL,CAAWV,KAAlB;AACH,aAHD,MAGK;AACDS,qBAAKC,KAAL,CAAWR,OAAX,GAAqBO,KAAKE,MAAL,CAAYT,OAAjC;AACAO,qBAAKC,KAAL,CAAWV,KAAX,GAAmBS,KAAKE,MAAL,CAAYX,KAA/B;AACA,uBAAOS,KAAKC,KAAL,CAAWV,KAAlB;AACH;AACJ,SATD;AAUH;;AAGD,QAAIa,QAAQ,EAAZ;;AAEA,aAASC,WAAT,CAAqBN,EAArB,EAAwBR,KAAxB,EAA8B;AAC1Ba,cAAML,EAAN,IAAY,IAAIF,YAAJ,CAAiBN,KAAjB,CAAZ;AACH;;AAED,aAASe,YAAT,CAAsBP,EAAtB,EAAyB;AACrB,eAAO,IAAIQ,OAAJ,CAAY,UAASC,OAAT,EAAiBC,MAAjB,EAAwB;AACvCD,oBAAQJ,MAAML,EAAN,EAAUR,KAAV,EAAR;AACH,SAFM,CAAP;AAGH;;AAEDc,gBAAY,OAAZ,EAAoB,EAACK,OAAM,KAAP,EAApB;;AAEA,QAAIC,IAAIL,aAAa,OAAb,CAAR;AACAK,MAAEC,IAAF,CAAO,UAAUC,CAAV,EAAa;AAChBC,gBAAQC,GAAR,CAAYF,CAAZ;AACH,KAFD;;AAIAC,YAAQC,GAAR,CAAYJ,CAAZ;AAGH,CA5DA,GAAD","file":"cache.js","sourcesContent":["(function () {\n    let server = require('./dummyServer.js')();\n\n    function TimeStampedObj(value, time) {\n        if(!time){\n            if (time === false) {\n                this.updated = null;\n            }\n            if (this.updated === undefined) {\n                this.updated = new Date();\n            }\n        }else{\n            this.updated = time;\n        }\n\n        this.value = value;\n        this.toString = function () {\n            return \"[object TimeStampedObj]\"\n        }\n    }\n\n    function CachedObject(initLocalValue,id) {\n        let that = this;\n        this.local = new TimeStampedObj(initLocalValue);\n        this.remote = new TimeStampedObj(null, false);\n        this.value = function () {\n            if(that.local.updated >= that.remote.updated){\n                server.pushup(id,that.local.value);\n                return that.local.value;\n            }else{\n                that.local.updated = that.remote.updated;\n                that.local.value = that.remote.value;\n                return that.local.value;\n            }\n        }\n    }\n\n\n    let cache = {};\n\n    function cacheObject(id,value){\n        cache[id] = new CachedObject(value);\n    }\n\n    function getFromCache(id){\n        return new Promise(function(resolve,reject){\n            resolve(cache[id].value());\n        });\n    }\n\n    cacheObject(\"state\",{state:\"bad\"});\n\n    let p = getFromCache(\"state\");\n    p.then(function (v) {\n        console.log(v);\n    });\n    \n    console.log(p);\n\n\n}());\n\n"]}